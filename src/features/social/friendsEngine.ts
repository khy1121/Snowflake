/**\n * 친구 시스템 엔진\n * 친구 추가, 요청, 수락, 목록 관리\n */\n\nexport type FriendStatus = 'pending' | 'accepted' | 'blocked';\n\nexport interface FriendRequest {\n  id: string;\n  userId: string;\n  friendUserId: string;\n  status: FriendStatus;\n  createdAt: number;\n  updatedAt: number;\n}\n\nexport interface UserProfile {\n  userId: string;\n  displayName: string;\n  friendCode: string;\n  stage: number;\n  power: number; // 전투력 (ATK * (1 + Crit%))\n  lastSeenAt: number;\n}\n\nexport interface FriendInfo extends UserProfile {\n  status: FriendStatus;\n  isFriend: boolean;\n}\n\n/**\n * 친구 코드 생성\n */\nexport function generateFriendCode(): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n  let code = '';\n  for (let i = 0; i < 8; i++) {\n    code += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return code;\n}\n\n/**\n * 친구 코드 유효성 확인\n */\nexport function isValidFriendCode(code: string): boolean {\n  const pattern = /^[A-Z0-9]{8}$/;\n  return pattern.test(code);\n}\n\n/**\n * 친구 요청 생성\n */\nexport function createFriendRequest(\n  userId: string,\n  friendUserId: string\n): FriendRequest {\n  return {\n    id: `friend_req_${userId}_${friendUserId}_${Date.now()}`,\n    userId,\n    friendUserId,\n    status: 'pending',\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n  };\n}\n\n/**\n * 친구 요청 수락\n */\nexport function acceptFriendRequest(request: FriendRequest): FriendRequest {\n  return {\n    ...request,\n    status: 'accepted',\n    updatedAt: Date.now(),\n  };\n}\n\n/**\n * 친구 요청 거절\n */\nexport function rejectFriendRequest(request: FriendRequest): FriendRequest {\n  return {\n    ...request,\n    status: 'blocked',\n    updatedAt: Date.now(),\n  };\n}\n\n/**\n * 친구 목록 필터링\n */\nexport function getAcceptedFriends(requests: FriendRequest[]): FriendRequest[] {\n  return requests.filter((req) => req.status === 'accepted');\n}\n\n/**\n * 대기 중인 친구 요청 필터링\n */\nexport function getPendingFriendRequests(requests: FriendRequest[]): FriendRequest[] {\n  return requests.filter((req) => req.status === 'pending');\n}\n\n/**\n * 전투력 계산\n */\nexport function calculatePower(\n  atk: number,\n  critChance: number = 0,\n  critDamage: number = 1\n): number {\n  return Math.round(atk * (1 + critChance * (critDamage - 1)));\n}\n\n/**\n * 사용자 프로필 생성\n */\nexport function createUserProfile(\n  userId: string,\n  displayName: string,\n  stage: number = 1,\n  atk: number = 10\n): UserProfile {\n  return {\n    userId,\n    displayName,\n    friendCode: generateFriendCode(),\n    stage,\n    power: calculatePower(atk),\n    lastSeenAt: Date.now(),\n  };\n}\n\n/**\n * 프로필 업데이트\n */\nexport function updateUserProfile(\n  profile: UserProfile,\n  updates: Partial<UserProfile>\n): UserProfile {\n  return {\n    ...profile,\n    ...updates,\n    lastSeenAt: Date.now(),\n  };\n}\n\n/**\n * 친구 정보 조회\n */\nexport function getFriendInfo(\n  profile: UserProfile,\n  friendRequest: FriendRequest | null\n): FriendInfo {\n  return {\n    ...profile,\n    status: friendRequest?.status || 'pending',\n    isFriend: friendRequest?.status === 'accepted',\n  };\n}\n
