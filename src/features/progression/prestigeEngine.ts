/**\n * Prestige(정비 등급) 시스템\n * 중기 메타: 스테이지 100 도달 후 리셋하여 영구 보너스 획득\n */\n\nexport interface PrestigeTreeNode {\n  nodeId: string;\n  name: string;\n  description: string;\n  type: string;\n  value: number;\n  cost: number;\n  tier: number;\n  prerequisite?: string;\n}\n\nexport interface PrestigeProgress {\n  prestigeCount: number;\n  prestigePoints: number;\n  unlockedNodes: string[];\n  permanentBonuses: Record<string, number>; // type -> total bonus\n}\n\n/**\n * Prestige 가능 여부 확인\n */\nexport function canPrestige(currentStage: number, minRequiredStage: number = 100): boolean {\n  return currentStage >= minRequiredStage;\n}\n\n/**\n * Prestige 실행\n */\nexport function performPrestige(\n  progress: PrestigeProgress,\n  prestigePointsGain: number = 1\n): PrestigeProgress {\n  return {\n    ...progress,\n    prestigeCount: progress.prestigeCount + 1,\n    prestigePoints: progress.prestigePoints + prestigePointsGain,\n  };\n}\n\n/**\n * Prestige 노드 언락\n */\nexport function unlockPrestigeNode(\n  progress: PrestigeProgress,\n  nodeId: string,\n  node: PrestigeTreeNode\n): {\n  updated: PrestigeProgress;\n  success: boolean;\n  reason?: string;\n} {\n  // 포인트 확인\n  if (progress.prestigePoints < node.cost) {\n    return {\n      updated: progress,\n      success: false,\n      reason: '정비 등급 포인트가 부족합니다.',\n    };\n  }\n\n  // 선행 조건 확인\n  if (node.prerequisite && !progress.unlockedNodes.includes(node.prerequisite)) {\n    return {\n      updated: progress,\n      success: false,\n      reason: '선행 노드를 먼저 언락해야 합니다.',\n    };\n  }\n\n  // 이미 언락됨\n  if (progress.unlockedNodes.includes(nodeId)) {\n    return {\n      updated: progress,\n      success: false,\n      reason: '이미 언락된 노드입니다.',\n    };\n  }\n\n  // 언락 처리\n  const updated: PrestigeProgress = {\n    ...progress,\n    prestigePoints: progress.prestigePoints - node.cost,\n    unlockedNodes: [...progress.unlockedNodes, nodeId],\n    permanentBonuses: {\n      ...progress.permanentBonuses,\n      [node.type]: (progress.permanentBonuses[node.type] || 0) + node.value,\n    },\n  };\n\n  return { updated, success: true };\n}\n\n/**\n * 영구 보너스 계산\n */\nexport function calculatePermanentBonus(\n  progress: PrestigeProgress,\n  bonusType: string\n): number {\n  return progress.permanentBonuses[bonusType] || 0;\n}\n\n/**\n * 모든 영구 보너스 계산\n */\nexport function calculateAllPermanentBonuses(progress: PrestigeProgress): Record<string, number> {\n  return { ...progress.permanentBonuses };\n}\n\n/**\n * Prestige 초기화\n */\nexport function initializePrestigeProgress(): PrestigeProgress {\n  return {\n    prestigeCount: 0,\n    prestigePoints: 0,\n    unlockedNodes: [],\n    permanentBonuses: {},\n  };\n}\n\n/**\n * 예상 Prestige 포인트 계산\n */\nexport function estimatePrestigePoints(\n  currentPrestigeCount: number\n): number {\n  // 기본: 1 포인트, 이후 +1씩 증가\n  return Math.max(1, currentPrestigeCount + 1);\n}\n
