/**\n * 보스 패턴 시스템\n * 보호막, 분노 등 패턴 흉내 구현\n */\n\nexport type BossPatternType = 'shield' | 'rage' | 'none';\n\nexport interface BossPatternState {\n  currentPattern: BossPatternType;\n  patternStartTime: number;\n  patternDuration: number;\n  hpThreshold: number; // HP 비율 (0~1)\n}\n\n/**\n * 보호막 패턴\n * - HP 30% 이하에서 활성화\n * - 3초간 피해 50% 감소\n */\nexport const SHIELD_PATTERN = {\n  hpThreshold: 0.3,\n  duration: 3000, // 3초\n  damageReduction: 0.5, // 50% 감소\n  skiaEffect: 'shield_ring', // Skia 연출: 외곽 링\n};\n\n/**\n * 분노 패턴\n * - 일정 시간 공격속도 증가\n * - 화면 가장자리 붉은 틴트 + 흔들림\n */\nexport const RAGE_PATTERN = {\n  duration: 5000, // 5초\n  attackSpeedMultiplier: 1.5, // 1.5배 공격 속도\n  skiaEffect: 'rage_tint', // Skia 연출: 붉은 틴트 + 흔들림\n};\n\n/**\n * 현재 활성 패턴 확인\n */\nexport function getActivePattern(\n  state: BossPatternState,\n  currentTime: number,\n  bossHpPercent: number\n): BossPatternType {\n  // 패턴 시간 만료 확인\n  if (currentTime - state.patternStartTime > state.patternDuration) {\n    // 새 패턴 결정\n    if (bossHpPercent <= SHIELD_PATTERN.hpThreshold) {\n      return 'shield';\n    }\n    return 'none';\n  }\n\n  return state.currentPattern;\n}\n\n/**\n * 패턴 상태 업데이트\n */\nexport function updateBossPatternState(\n  state: BossPatternState,\n  currentTime: number,\n  bossHpPercent: number\n): BossPatternState {\n  const activePattern = getActivePattern(state, currentTime, bossHpPercent);\n\n  if (activePattern === state.currentPattern) {\n    return state; // 패턴 유지\n  }\n\n  // 패턴 변경\n  return {\n    currentPattern: activePattern,\n    patternStartTime: currentTime,\n    patternDuration: activePattern === 'shield' ? SHIELD_PATTERN.duration : RAGE_PATTERN.duration,\n    hpThreshold: bossHpPercent,\n  };\n}\n\n/**\n * 패턴에 따른 피해 계산\n */\nexport function calculateDamageWithPattern(\n  baseDamage: number,\n  pattern: BossPatternType\n): number {\n  if (pattern === 'shield') {\n    return baseDamage * (1 - SHIELD_PATTERN.damageReduction);\n  }\n  return baseDamage;\n}\n\n/**\n * 패턴에 따른 공격속도 계산\n */\nexport function calculateAttackSpeedWithPattern(\n  baseSpeed: number,\n  pattern: BossPatternType\n): number {\n  if (pattern === 'rage') {\n    return baseSpeed * RAGE_PATTERN.attackSpeedMultiplier;\n  }\n  return baseSpeed;\n}\n\n/**\n * 패턴 초기화\n */\nexport function initializeBossPatternState(): BossPatternState {\n  return {\n    currentPattern: 'none',\n    patternStartTime: 0,\n    patternDuration: 0,\n    hpThreshold: 1,\n  };\n}\n\n/**\n * Skia 연출 정보 조회\n */\nexport function getSkiaEffectInfo(pattern: BossPatternType): { type: string; intensity: number } {\n  switch (pattern) {\n    case 'shield':\n      return { type: 'shield_ring', intensity: 1 };\n    case 'rage':\n      return { type: 'rage_tint', intensity: 0.3 }; // 약한 틴트\n    default:\n      return { type: 'none', intensity: 0 };\n  }\n}\n
