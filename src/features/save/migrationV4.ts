/**\n * SaveState 마이그레이션 V3 → V4 (Sprint 4)\n */\n\nimport { SaveState } from '@/types';\nimport { initializePassProgress } from '@/features/progression/passSystem';\nimport { initializeCosmetics } from '@/features/cosmetics/cosmeticSystem';\n\nconst CURRENT_VERSION = 4;\n\n/**\n * V3 SaveState 타입 (호환성)\n */\ninterface SaveStateV3 {\n  version: 3;\n  lastSeenAt: number;\n  currentStage: number;\n  gold: number;\n  hp: number;\n  atk: number;\n  upgradeLevels: Record<string, number>;\n  offlineRewardClaimed: boolean;\n  tutorialCompleted: boolean;\n  tutorialStep: number;\n  dailyQuestProgress: Record<string, any>;\n  achievementProgress: Record<string, any>;\n  totalBattleWins: number;\n  totalUpgrades: number;\n  totalGoldEarned: number;\n  totalOfflineRewardsClaimed: number;\n  lastDailyResetTime: number;\n  stats: {\n    totalBattles: number;\n    totalStagesCleared: number;\n    highestStageReached: number;\n  };\n  fragments: number;\n  companionShards: Record<string, number>;\n  companionProgress: Record<string, any>;\n  storyProgress: Record<string, any>;\n}\n\n/**\n * V3 → V4 마이그레이션\n */\nexport function migrateFromV3(v3: SaveStateV3): SaveState {\n  return {\n    version: CURRENT_VERSION,\n    lastSeenAt: v3.lastSeenAt,\n    currentStage: v3.currentStage,\n    gold: v3.gold,\n    hp: v3.hp,\n    atk: v3.atk,\n    upgradeLevels: v3.upgradeLevels,\n    offlineRewardClaimed: v3.offlineRewardClaimed,\n    tutorialCompleted: v3.tutorialCompleted,\n    tutorialStep: v3.tutorialStep,\n    dailyQuestProgress: v3.dailyQuestProgress,\n    achievementProgress: v3.achievementProgress,\n    totalBattleWins: v3.totalBattleWins,\n    totalUpgrades: v3.totalUpgrades,\n    totalGoldEarned: v3.totalGoldEarned,\n    totalOfflineRewardsClaimed: v3.totalOfflineRewardsClaimed,\n    lastDailyResetTime: v3.lastDailyResetTime,\n    stats: v3.stats,\n    fragments: v3.fragments,\n    companionShards: v3.companionShards,\n    companionProgress: v3.companionProgress,\n    storyProgress: v3.storyProgress,\n    // Sprint 4 필드\n    cosmeticTokens: 0,\n    cosmeticProgress: initializeCosmetics(),\n    passProgress: initializePassProgress(),\n    adRewardCooldowns: {\n      OFFLINE_DOUBLE: 0,\n      BONUS_CHEST: 0,\n      PASS_XP_BOOST: 0,\n    },\n    remoteConfigVersion: '1.0',\n  };\n}\n\n/**\n * SaveState 마이그레이션 통합\n */\nexport function migrateToV4(saved: any): SaveState {\n  if (saved.version === CURRENT_VERSION) {\n    return saved as SaveState;\n  }\n\n  if (saved.version === 3) {\n    return migrateFromV3(saved as SaveStateV3);\n  }\n\n  // V2 이하는 V3로 먼저 마이그레이션\n  // (이전 마이그레이션 함수 호출)\n  return getDefaultSaveStateV4();\n}\n\n/**\n * 기본 SaveState V4\n */\nexport function getDefaultSaveStateV4(): SaveState {\n  return {\n    version: CURRENT_VERSION,\n    lastSeenAt: Date.now(),\n    currentStage: 1,\n    gold: 0,\n    hp: 100,\n    atk: 5,\n    upgradeLevels: {\n      atk: 0,\n      hp: 0,\n      attackSpeed: 0,\n      critChance: 0,\n      critDamage: 0,\n      offlineEfficiency: 0,\n    },\n    offlineRewardClaimed: false,\n    tutorialCompleted: false,\n    tutorialStep: 0,\n    dailyQuestProgress: {},\n    achievementProgress: {},\n    totalBattleWins: 0,\n    totalUpgrades: 0,\n    totalGoldEarned: 0,\n    totalOfflineRewardsClaimed: 0,\n    lastDailyResetTime: Date.now(),\n    stats: {\n      totalBattles: 0,\n      totalStagesCleared: 0,\n      highestStageReached: 1,\n    },\n    fragments: 0,\n    companionShards: {},\n    companionProgress: {},\n    storyProgress: {\n      currentChapter: 1,\n      currentEpisode: 0,\n      viewedEpisodes: [],\n    },\n    // Sprint 4\n    cosmeticTokens: 0,\n    cosmeticProgress: initializeCosmetics(),\n    passProgress: initializePassProgress(),\n    adRewardCooldowns: {\n      OFFLINE_DOUBLE: 0,\n      BONUS_CHEST: 0,\n      PASS_XP_BOOST: 0,\n    },\n    remoteConfigVersion: '1.0',\n  };\n}\n
