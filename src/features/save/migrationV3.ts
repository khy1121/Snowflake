/**
 * SaveState 마이그레이션 V2 → V3 (Sprint 3)\n */\n\nimport { SaveState, CompanionProgress, StoryProgress } from '@/types';\nimport { initializeCompanions } from '@/features/progression/companionEngine';\nimport { initializeStoryProgress } from '@/features/progression/storyEngine';\n\nconst CURRENT_VERSION = 3;\n\n/**\n * V2 SaveState 타입 (호환성)\n */\ninterface SaveStateV2 {\n  version: 2;\n  lastSeenAt: number;\n  currentStage: number;\n  gold: number;\n  hp: number;\n  atk: number;\n  upgradeLevels: Record<string, number>;\n  offlineRewardClaimed: boolean;\n  tutorialCompleted: boolean;\n  tutorialStep: number;\n  dailyQuestProgress: Record<string, any>;\n  achievementProgress: Record<string, any>;\n  totalBattleWins: number;\n  totalUpgrades: number;\n  totalGoldEarned: number;\n  totalOfflineRewardsClaimed: number;\n  lastDailyResetTime: number;\n  stats: {\n    totalBattles: number;\n    totalStagesCleared: number;\n    highestStageReached: number;\n  };\n}\n\n/**\n * V2 → V3 마이그레이션\n */\nexport function migrateFromV2(v2: SaveStateV2): SaveState {\n  return {\n    version: CURRENT_VERSION,\n    lastSeenAt: v2.lastSeenAt,\n    currentStage: v2.currentStage,\n    gold: v2.gold,\n    hp: v2.hp,\n    atk: v2.atk,\n    upgradeLevels: v2.upgradeLevels,\n    offlineRewardClaimed: v2.offlineRewardClaimed,\n    tutorialCompleted: v2.tutorialCompleted,\n    tutorialStep: v2.tutorialStep,\n    dailyQuestProgress: v2.dailyQuestProgress,\n    achievementProgress: v2.achievementProgress,\n    totalBattleWins: v2.totalBattleWins,\n    totalUpgrades: v2.totalUpgrades,\n    totalGoldEarned: v2.totalGoldEarned,\n    totalOfflineRewardsClaimed: v2.totalOfflineRewardsClaimed,\n    lastDailyResetTime: v2.lastDailyResetTime,\n    stats: v2.stats,\n    // Sprint 3 필드\n    fragments: 0,\n    companionShards: {},\n    companionProgress: initializeCompanions(),\n    storyProgress: initializeStoryProgress(),\n  };\n}\n\n/**\n * SaveState 마이그레이션 통합\n */\nexport function migrateToV3(saved: any): SaveState {\n  if (saved.version === CURRENT_VERSION) {\n    return saved as SaveState;\n  }\n\n  if (saved.version === 2) {\n    return migrateFromV2(saved as SaveStateV2);\n  }\n\n  // 알 수 없는 버전: 기본값 반환\n  return getDefaultSaveStateV3();\n}\n\n/**\n * 기본 SaveState V3\n */\nexport function getDefaultSaveStateV3(): SaveState {\n  return {\n    version: CURRENT_VERSION,\n    lastSeenAt: Date.now(),\n    currentStage: 1,\n    gold: 0,\n    hp: 100,\n    atk: 5,\n    upgradeLevels: {\n      atk: 0,\n      hp: 0,\n      attackSpeed: 0,\n      critChance: 0,\n      critDamage: 0,\n      offlineEfficiency: 0,\n    },\n    offlineRewardClaimed: false,\n    tutorialCompleted: false,\n    tutorialStep: 0,\n    dailyQuestProgress: {},\n    achievementProgress: {},\n    totalBattleWins: 0,\n    totalUpgrades: 0,\n    totalGoldEarned: 0,\n    totalOfflineRewardsClaimed: 0,\n    lastDailyResetTime: Date.now(),\n    stats: {\n      totalBattles: 0,\n      totalStagesCleared: 0,\n      highestStageReached: 1,\n    },\n    // Sprint 3\n    fragments: 0,\n    companionShards: {},\n    companionProgress: initializeCompanions(),\n    storyProgress: initializeStoryProgress(),\n  };\n}\n
