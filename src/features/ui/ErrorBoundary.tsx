/**\n * ì—ëŸ¬ ë°”ìš´ë”ë¦¬ (Error Boundary)\n * React ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ì˜ ì—ëŸ¬ë¥¼ ìºì¹˜í•˜ê³  ì²˜ë¦¬\n */\n\nimport React, { ReactNode } from 'react';\nimport {\n  View,\n  Text,\n  StyleSheet,\n  TouchableOpacity,\n  SafeAreaView,\n} from 'react-native';\nimport { colors, spacing, typography, borderRadius } from './theme';\nimport { logger } from '@/utils/logger';\n\ninterface ErrorBoundaryProps {\n  children: ReactNode;\n  fallback?: (error: Error, retry: () => void) => ReactNode;\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: colors.background,\n    justifyContent: 'center',\n    alignItems: 'center',\n    padding: spacing.lg,\n  },\n  card: {\n    backgroundColor: colors.surface,\n    borderRadius: borderRadius.lg,\n    padding: spacing.lg,\n    alignItems: 'center',\n  },\n  icon: {\n    fontSize: 48,\n    marginBottom: spacing.md,\n  },\n  title: {\n    ...typography.h2,\n    color: colors.error,\n    marginBottom: spacing.sm,\n    textAlign: 'center',\n  },\n  message: {\n    ...typography.body,\n    color: colors.textLight,\n    marginBottom: spacing.lg,\n    textAlign: 'center',\n  },\n  errorText: {\n    ...typography.small,\n    color: colors.error,\n    backgroundColor: colors.background,\n    borderRadius: borderRadius.md,\n    padding: spacing.md,\n    marginBottom: spacing.lg,\n    maxHeight: 100,\n  },\n  button: {\n    backgroundColor: colors.primary,\n    paddingHorizontal: spacing.lg,\n    paddingVertical: spacing.md,\n    borderRadius: borderRadius.md,\n  },\n  buttonText: {\n    ...typography.button,\n    color: colors.onPrimary,\n  },\n});\n\nexport class ErrorBoundary extends React.Component<\n  ErrorBoundaryProps,\n  ErrorBoundaryState\n> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n    };\n  }\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return {\n      hasError: true,\n      error,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo): void {\n    // ì—ëŸ¬ ë¡œê¹…\n    logger.error('REACT_ERROR', error.message, {\n      stack: error.stack,\n      componentStack: errorInfo.componentStack,\n    });\n\n    // ì¶”í›„ Sentry ë“±ìœ¼ë¡œ ì „ì†¡ ê°€ëŠ¥\n  }\n\n  handleRetry = (): void => {\n    this.setState({\n      hasError: false,\n      error: null,\n    });\n  };\n\n  render(): ReactNode {\n    if (this.state.hasError && this.state.error) {\n      if (this.props.fallback) {\n        return this.props.fallback(this.state.error, this.handleRetry);\n      }\n\n      return (\n        <SafeAreaView style={styles.container}>\n          <View style={styles.card}>\n            <Text style={styles.icon}>ğŸ˜…</Text>\n            <Text style={styles.title}>ì•—! ë­”ê°€ ì˜ëª»ëì–´</Text>\n            <Text style={styles.message}>\n              ì •ë¹„ì†Œê°€ ì ê¹ í˜¼ë€ìŠ¤ëŸ¬ì›Œí•˜ê³  ìˆì–´ìš”. ë‹¤ì‹œ í•œ ë²ˆ ì‹œë„í•´ë³¼ê¹Œ?\n            </Text>\n            {__DEV__ && (\n              <Text style={styles.errorText}>{this.state.error.message}</Text>\n            )}\n            <TouchableOpacity style={styles.button} onPress={this.handleRetry}>\n              <Text style={styles.buttonText}>ë‹¤ì‹œ ì‹œë„</Text>\n            </TouchableOpacity>\n          </View>\n        </SafeAreaView>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\n/**\n * ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬\n */\nexport function setupGlobalErrorHandler(): void {\n  // ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€\n  const originalWarn = console.warn;\n  console.warn = (...args: any[]) => {\n    if (\n      typeof args[0] === 'string' &&\n      args[0].includes('Non-serializable values were found')\n    ) {\n      return; // Redux ê²½ê³  ë¬´ì‹œ\n    }\n    originalWarn(...args);\n  };\n\n  // ì—ëŸ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ\n  if (typeof ErrorEvent !== 'undefined') {\n    const originalError = console.error;\n    console.error = (...args: any[]) => {\n      logger.error('GLOBAL_ERROR', String(args[0]), args.slice(1));\n      originalError(...args);\n    };\n  }\n}\n
