/**\n * 결제(Purchase) 제공자\n * Mock 및 실제 결제 SDK 연동\n */\n\nexport type ProductSku = 'premium_pass_season' | 'cosmetic_token_pack_small';\n\nexport interface PurchaseResult {\n  success: boolean;\n  sku: ProductSku;\n  transactionId?: string;\n  timestamp: number;\n}\n\nexport interface IPurchaseProvider {\n  purchaseProduct(sku: ProductSku): Promise<PurchaseResult>;\n  restorePurchases(): Promise<PurchaseResult[]>;\n  getProductInfo(sku: ProductSku): Promise<{ price: string; currency: string } | null>;\n}\n\n/**\n * Mock 결제 제공자 (개발용)\n */\nexport class MockPurchaseProvider implements IPurchaseProvider {\n  private purchases: Map<ProductSku, number> = new Map();\n\n  async purchaseProduct(sku: ProductSku): Promise<PurchaseResult> {\n    // 구매 시뮬레이션 (1초 대기)\n    await new Promise((resolve) => setTimeout(resolve, 1000));\n\n    // 항상 성공\n    const count = (this.purchases.get(sku) || 0) + 1;\n    this.purchases.set(sku, count);\n\n    return {\n      success: true,\n      sku,\n      transactionId: `mock_${sku}_${count}`,\n      timestamp: Date.now(),\n    };\n  }\n\n  async restorePurchases(): Promise<PurchaseResult[]> {\n    const results: PurchaseResult[] = [];\n\n    this.purchases.forEach((count, sku) => {\n      for (let i = 0; i < count; i++) {\n        results.push({\n          success: true,\n          sku,\n          transactionId: `mock_${sku}_${i + 1}`,\n          timestamp: Date.now(),\n        });\n      }\n    });\n\n    return results;\n  }\n\n  async getProductInfo(\n    sku: ProductSku\n  ): Promise<{ price: string; currency: string } | null> {\n    const products: Record<ProductSku, { price: string; currency: string }> = {\n      premium_pass_season: { price: '9.99', currency: 'USD' },\n      cosmetic_token_pack_small: { price: '4.99', currency: 'USD' },\n    };\n\n    return products[sku] || null;\n  }\n}\n\n/**\n * 실제 Google Play Billing 제공자\n * 주석: 실제 구현 시 다음과 같이 구현할 수 있습니다.\n *\n * import { BillingClient, BillingFlowParams } from '@react-native-google-play-billing/google-play-billing';\n *\n * export class GooglePlayPurchaseProvider implements IPurchaseProvider {\n *   private billingClient: BillingClient;\n *\n *   constructor() {\n *     this.billingClient = new BillingClient();\n *   }\n *\n *   async purchaseProduct(sku: ProductSku): Promise<PurchaseResult> {\n *     try {\n *       const params: BillingFlowParams = {\n *         skus: [sku],\n *       };\n *\n *       const result = await this.billingClient.requestPurchase(params);\n *\n *       if (result.responseCode === BillingResponseCode.OK) {\n *         return {\n *           success: true,\n *           sku,\n *           transactionId: result.purchases[0].orderId,\n *           timestamp: Date.now(),\n *         };\n *       } else {\n *         return {\n *           success: false,\n *           sku,\n *           timestamp: Date.now(),\n *         };\n *       }\n *     } catch (error) {\n *       console.error('Purchase failed:', error);\n *       return {\n *         success: false,\n *         sku,\n *         timestamp: Date.now(),\n *       };\n *     }\n *   }\n *\n *   async restorePurchases(): Promise<PurchaseResult[]> {\n *     try {\n *       const purchases = await this.billingClient.queryPurchases('inapp');\n *       return purchases.map((purchase) => ({\n *         success: true,\n *         sku: purchase.sku as ProductSku,\n *         transactionId: purchase.orderId,\n *         timestamp: purchase.purchaseTime,\n *       }));\n *     } catch (error) {\n *       console.error('Restore purchases failed:', error);\n *       return [];\n *     }\n *   }\n *\n *   async getProductInfo(\n *     sku: ProductSku\n *   ): Promise<{ price: string; currency: string } | null> {\n *     try {\n *       const products = await this.billingClient.querySkuDetails({\n *         skus: [sku],\n *         type: 'inapp',\n *       });\n *\n *       if (products.length > 0) {\n *         return {\n *           price: products[0].price,\n *           currency: products[0].priceCurrencyCode,\n *         };\n *       }\n *       return null;\n *     } catch (error) {\n *       console.error('Get product info failed:', error);\n *       return null;\n *     }\n *   }\n * }\n */\n\n/**\n * 싱글톤 인스턴스\n */\nlet purchaseProvider: IPurchaseProvider = new MockPurchaseProvider();\n\n/**\n * 결제 제공자 설정\n */\nexport function setPurchaseProvider(provider: IPurchaseProvider): void {\n  purchaseProvider = provider;\n}\n\n/**\n * 결제 제공자 조회\n */\nexport function getPurchaseProvider(): IPurchaseProvider {\n  return purchaseProvider;\n}\n\n/**\n * 편의 함수\n */\nexport async function purchaseProduct(sku: ProductSku): Promise<PurchaseResult> {\n  return purchaseProvider.purchaseProduct(sku);\n}\n\nexport async function restorePurchases(): Promise<PurchaseResult[]> {\n  return purchaseProvider.restorePurchases();\n}\n\nexport async function getProductInfo(\n  sku: ProductSku\n): Promise<{ price: string; currency: string } | null> {\n  return purchaseProvider.getProductInfo(sku);\n}\n
