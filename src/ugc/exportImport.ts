/**\n * UGC Export/Import 유틸\n * Sprint 10: 서버 없이 공유 코드 기반 공유\n */\n\nimport { UGCScenario } from './types';\nimport { validateScenario, validatePayloadSize } from './validateScenario';\n\n/**\n * Base64 인코딩\n */\nfunction base64Encode(str: string): string {\n  return Buffer.from(str, 'utf-8').toString('base64');\n}\n\n/**\n * Base64 디코딩\n */\nfunction base64Decode(str: string): string {\n  return Buffer.from(str, 'base64').toString('utf-8');\n}\n\n/**\n * 시나리오를 공유 코드로 변환\n * 최소화 + Base64 인코딩\n */\nexport function scenarioToShareCode(scenario: UGCScenario): string {\n  try {\n    const json = JSON.stringify(scenario);\n\n    // 페이로드 크기 검증 (100KB 제한)\n    if (!validatePayloadSize(json, 100)) {\n      throw new Error('시나리오가 너무 큽니다. 스테이지나 대사를 줄여주세요.');\n    }\n\n    // Base64 인코딩\n    const encoded = base64Encode(json);\n    return encoded;\n  } catch (error) {\n    throw new Error(`Export 실패: ${error instanceof Error ? error.message : '알 수 없는 오류'}`);\n  }\n}\n\n/**\n * 공유 코드를 시나리오로 변환\n */\nexport function shareCodeToScenario(shareCode: string): UGCScenario {\n  try {\n    // Base64 디코딩\n    const json = base64Decode(shareCode);\n\n    // JSON 파싱\n    const scenario = JSON.parse(json) as UGCScenario;\n\n    // 검증\n    const validation = validateScenario(scenario);\n    if (!validation.isValid) {\n      throw new Error(`검증 실패: ${validation.errors.join(', ')}`);\n    }\n\n    return scenario;\n  } catch (error) {\n    throw new Error(`Import 실패: ${error instanceof Error ? error.message : '알 수 없는 오류'}`);\n  }\n}\n\n/**\n * 시나리오를 JSON 파일로 내보내기 (문자열)\n */\nexport function scenarioToJSON(scenario: UGCScenario): string {\n  return JSON.stringify(scenario, null, 2);\n}\n\n/**\n * JSON 문자열을 시나리오로 변환\n */\nexport function jsonToScenario(jsonString: string): UGCScenario {\n  try {\n    const scenario = JSON.parse(jsonString) as UGCScenario;\n\n    // 검증\n    const validation = validateScenario(scenario);\n    if (!validation.isValid) {\n      throw new Error(`검증 실패: ${validation.errors.join(', ')}`);\n    }\n\n    return scenario;\n  } catch (error) {\n    throw new Error(`JSON 파싱 실패: ${error instanceof Error ? error.message : '알 수 없는 오류'}`);\n  }\n}\n\n/**\n * 공유 코드 길이 계산\n */\nexport function getShareCodeLength(scenario: UGCScenario): number {\n  const json = JSON.stringify(scenario);\n  return base64Encode(json).length;\n}\n\n/**\n * 공유 코드 미리보기 (첫 50자)\n */\nexport function getShareCodePreview(shareCode: string): string {\n  return shareCode.substring(0, 50) + (shareCode.length > 50 ? '...' : '');\n}\n\n/**\n * 시나리오 메타데이터 추출\n */\nexport function extractScenarioMetadata(scenario: UGCScenario) {\n  return {\n    id: scenario.id,\n    title: scenario.title,\n    authorName: scenario.authorName,\n    difficultyTag: scenario.difficultyTag,\n    stageCount: scenario.stages.length,\n    dialogueCount: scenario.dialogues?.length || 0,\n    createdAt: new Date(scenario.createdAt).toLocaleString(),\n    updatedAt: new Date(scenario.updatedAt).toLocaleString(),\n  };\n}\n
