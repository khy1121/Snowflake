/**\n * 정비소 꾸미기 유닛 테스트\n */\n\nimport {\n  isDecorUnlocked,\n  purchaseDecor,\n  addDecorPlacement,\n  removeDecorPlacement,\n  updateDecorPlacement,\n  savePreset,\n  loadPreset,\n  validatePlacements,\n  getMaxPlacementCount,\n} from '../features/customization/decorEngine';\n\ndescribe('Decor Engine', () => {\n  describe('Unlock Conditions', () => {\n    test('isDecorUnlocked should return true for start items', () => {\n      expect(isDecorUnlocked('wallpaper_wood', [], 0, {}, [], 0)).toBe(true);\n    });\n\n    test('isDecorUnlocked should return true when stage reached', () => {\n      expect(isDecorUnlocked('wallpaper_stone', [], 20, {}, [], 0)).toBe(true);\n      expect(isDecorUnlocked('wallpaper_stone', [], 19, {}, [], 0)).toBe(false);\n    });\n\n    test('isDecorUnlocked should return true for unlocked items', () => {\n      expect(isDecorUnlocked('wallpaper_stone', ['wallpaper_stone'], 0, {}, [], 0)).toBe(true);\n    });\n\n    test('isDecorUnlocked should check achievement conditions', () => {\n      expect(\n        isDecorUnlocked('lamp_warm', [], 0, { achievement_10: true }, [], 0)\n      ).toBe(true);\n      expect(isDecorUnlocked('lamp_warm', [], 0, { achievement_10: false }, [], 0)).toBe(false);\n    });\n\n    test('isDecorUnlocked should check companion conditions', () => {\n      expect(isDecorUnlocked('mascot_goblin', [], 0, {}, ['goblin'], 0)).toBe(true);\n      expect(isDecorUnlocked('mascot_goblin', [], 0, {}, [], 0)).toBe(false);\n    });\n\n    test('isDecorUnlocked should check prestige conditions', () => {\n      expect(isDecorUnlocked('workbench_metal', [], 0, {}, [], 1)).toBe(true);\n      expect(isDecorUnlocked('workbench_metal', [], 0, {}, [], 0)).toBe(false);\n    });\n  });\n\n  describe('Purchase', () => {\n    test('purchaseDecor should succeed with sufficient tokens', () => {\n      const result = purchaseDecor('wallpaper_wood', 200, 100);\n      expect(result.success).toBe(true);\n      expect(result.remainingTokens).toBe(100);\n    });\n\n    test('purchaseDecor should fail with insufficient tokens', () => {\n      const result = purchaseDecor('wallpaper_wood', 50, 100);\n      expect(result.success).toBe(false);\n      expect(result.error).toBe('토큰 부족');\n    });\n  });\n\n  describe('Placement', () => {\n    test('addDecorPlacement should add placement', () => {\n      const result = addDecorPlacement([], 'plant_small', { x: 100, y: 100 });\n      expect(result.success).toBe(true);\n      expect(result.placements.length).toBe(1);\n      expect(result.placements[0].itemId).toBe('plant_small');\n    });\n\n    test('addDecorPlacement should respect max count', () => {\n      let placements: any[] = [];\n      // wallpaper_wood는 최대 1개\n      placements = addDecorPlacement(placements, 'wallpaper_wood', { x: 0, y: 0 }).placements;\n      const result = addDecorPlacement(placements, 'wallpaper_wood', { x: 100, y: 100 });\n      expect(result.success).toBe(false);\n      expect(result.error).toContain('최대');\n    });\n\n    test('addDecorPlacement should allow multiple items up to max', () => {\n      let placements: any[] = [];\n      // plant_small은 최대 10개\n      for (let i = 0; i < 10; i++) {\n        const result = addDecorPlacement(placements, 'plant_small', { x: i * 50, y: 0 });\n        expect(result.success).toBe(true);\n        placements = result.placements;\n      }\n      expect(placements.length).toBe(10);\n    });\n\n    test('removeDecorPlacement should remove placement', () => {\n      const placement = { id: 'test_1', itemId: 'plant_small', position: { x: 0, y: 0 }, rotation: 0, createdAt: Date.now() };\n      const placements = [placement];\n      const result = removeDecorPlacement(placements, 'test_1');\n      expect(result.length).toBe(0);\n    });\n\n    test('updateDecorPlacement should update placement', () => {\n      const placement = { id: 'test_1', itemId: 'plant_small', position: { x: 0, y: 0 }, rotation: 0, createdAt: Date.now() };\n      const placements = [placement];\n      const result = updateDecorPlacement(placements, 'test_1', { rotation: 45 });\n      expect(result[0].rotation).toBe(45);\n      expect(result[0].itemId).toBe('plant_small');\n    });\n  });\n\n  describe('Presets', () => {\n    test('savePreset should save placement configuration', () => {\n      const placements = [\n        { id: '1', itemId: 'plant_small', position: { x: 0, y: 0 }, rotation: 0, createdAt: Date.now() },\n      ];\n      const presets: any[] = [];\n      const result = savePreset(presets, placements, 0, '내 정비소 1');\n      expect(result[0].name).toBe('내 정비소 1');\n      expect(result[0].placements.length).toBe(1);\n    });\n\n    test('loadPreset should load saved placements', () => {\n      const placements = [\n        { id: '1', itemId: 'plant_small', position: { x: 0, y: 0 }, rotation: 0, createdAt: Date.now() },\n      ];\n      const presets: any[] = [];\n      const saved = savePreset(presets, placements, 0, '내 정비소 1');\n      const loaded = loadPreset(saved, 0);\n      expect(loaded.length).toBe(1);\n      expect(loaded[0].itemId).toBe('plant_small');\n    });\n\n    test('loadPreset should return empty array for non-existent preset', () => {\n      const presets: any[] = [];\n      const result = loadPreset(presets, 0);\n      expect(result.length).toBe(0);\n    });\n  });\n\n  describe('Validation', () => {\n    test('validatePlacements should return true for valid placements', () => {\n      const placements = [\n        { id: '1', itemId: 'plant_small', position: { x: 0, y: 0 }, rotation: 0, createdAt: Date.now() },\n        { id: '2', itemId: 'plant_small', position: { x: 50, y: 0 }, rotation: 0, createdAt: Date.now() },\n      ];\n      expect(validatePlacements(placements)).toBe(true);\n    });\n\n    test('validatePlacements should return false for exceeded max count', () => {\n      const placements = [];\n      for (let i = 0; i < 2; i++) {\n        placements.push({\n          id: `${i}`,\n          itemId: 'wallpaper_wood',\n          position: { x: 0, y: 0 },\n          rotation: 0,\n          createdAt: Date.now(),\n        });\n      }\n      expect(validatePlacements(placements)).toBe(false);\n    });\n  });\n\n  describe('Max Placement Count', () => {\n    test('getMaxPlacementCount should return correct limits', () => {\n      expect(getMaxPlacementCount('wallpaper_wood')).toBe(1);\n      expect(getMaxPlacementCount('lamp_warm')).toBe(3);\n      expect(getMaxPlacementCount('plant_small')).toBe(10);\n      expect(getMaxPlacementCount('mascot_goblin')).toBe(5);\n    });\n  });\n});\n
