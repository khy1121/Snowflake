/**\n * 동료 시너지 유닛 테스트\n */\n\nimport {\n  getActiveSynergies,\n  applySynergyEffects,\n  applySynergyEffect,\n  checkSynergyCondition,\n  calculateSynergyProgress,\n  getSynergyEffectDescription,\n  getNextSynergies,\n  getSynergyStats,\n  validateSynergyData,\n} from '../features/progression/synergyEngine';\n\nconst mockSynergies = [\n  {\n    id: 'goblin_team',\n    name: '도깨비 정비반',\n    description: '도깨비 기술자 + 도깨비 장인',\n    requiredCompanionIds: ['goblin_technician', 'goblin_craftsman'],\n    effects: [{ type: 'gold', value: 0.1, description: '골드 획득량 +10%' }],\n    rarity: 'common',\n  },\n  {\n    id: 'spirit_trio',\n    name: '정령 삼중주',\n    description: '해태 + 구미호 + 청룡',\n    requiredCompanionIds: ['haetae', 'gumiho', 'blue_dragon'],\n    effects: [{ type: 'fragment', value: 0.15, description: '파편 획득량 +15%' }],\n    rarity: 'rare',\n  },\n];\n\ndescribe('Synergy Engine', () => {\n  describe('Active Synergies', () => {\n    test('getActiveSynergies should return empty for no companions', () => {\n      const active = getActiveSynergies([], mockSynergies);\n      expect(active.length).toBe(0);\n    });\n\n    test('getActiveSynergies should return matching synergies', () => {\n      const companions = ['goblin_technician', 'goblin_craftsman'];\n      const active = getActiveSynergies(companions, mockSynergies);\n      expect(active.length).toBe(1);\n      expect(active[0].id).toBe('goblin_team');\n    });\n\n    test('getActiveSynergies should return multiple synergies', () => {\n      const companions = ['goblin_technician', 'goblin_craftsman', 'haetae', 'gumiho', 'blue_dragon'];\n      const active = getActiveSynergies(companions, mockSynergies);\n      expect(active.length).toBe(2);\n    });\n  });\n\n  describe('Synergy Effects', () => {\n    test('applySynergyEffect should apply gold bonus', () => {\n      const stats = { gold: 1000, fragment: 0, hp: 100, atk: 10, attackSpeed: 1, critChance: 0, critDamage: 1, offline: 1, passXp: 1 };\n      const effect = { type: 'gold', value: 0.1, description: '+10%' };\n      const result = applySynergyEffect(stats, effect);\n      expect(result.gold).toBe(1100);\n    });\n\n    test('applySynergyEffect should apply fragment bonus', () => {\n      const stats = { gold: 1000, fragment: 100, hp: 100, atk: 10, attackSpeed: 1, critChance: 0, critDamage: 1, offline: 1, passXp: 1 };\n      const effect = { type: 'fragment', value: 0.15, description: '+15%' };\n      const result = applySynergyEffect(stats, effect);\n      expect(result.fragment).toBe(115);\n    });\n\n    test('applySynergyEffect should apply HP bonus', () => {\n      const stats = { gold: 1000, fragment: 100, hp: 100, atk: 10, attackSpeed: 1, critChance: 0, critDamage: 1, offline: 1, passXp: 1 };\n      const effect = { type: 'hp', value: 0.2, description: '+20%' };\n      const result = applySynergyEffect(stats, effect);\n      expect(result.hp).toBe(120);\n    });\n\n    test('applySynergyEffect should apply attack speed bonus', () => {\n      const stats = { gold: 1000, fragment: 100, hp: 100, atk: 10, attackSpeed: 1, critChance: 0, critDamage: 1, offline: 1, passXp: 1 };\n      const effect = { type: 'attackSpeed', value: 0.15, description: '+15%' };\n      const result = applySynergyEffect(stats, effect);\n      expect(result.attackSpeed).toBe(1.15);\n    });\n\n    test('applySynergyEffects should apply multiple effects', () => {\n      const stats = { gold: 1000, fragment: 100, hp: 100, atk: 10, attackSpeed: 1, critChance: 0, critDamage: 1, offline: 1, passXp: 1 };\n      const synergies = [\n        {\n          id: 'test1',\n          name: 'Test',\n          description: 'Test',\n          requiredCompanionIds: [],\n          effects: [\n            { type: 'gold', value: 0.1, description: '+10%' },\n            { type: 'fragment', value: 0.1, description: '+10%' },\n          ],\n          rarity: 'common',\n        },\n      ];\n      const result = applySynergyEffects(stats, synergies);\n      expect(result.gold).toBe(1100);\n      expect(result.fragment).toBe(110);\n    });\n  });\n\n  describe('Synergy Condition', () => {\n    test('checkSynergyCondition should return true when all companions present', () => {\n      const companions = ['goblin_technician', 'goblin_craftsman'];\n      expect(checkSynergyCondition(mockSynergies[0], companions)).toBe(true);\n    });\n\n    test('checkSynergyCondition should return false when missing companions', () => {\n      const companions = ['goblin_technician'];\n      expect(checkSynergyCondition(mockSynergies[0], companions)).toBe(false);\n    });\n  });\n\n  describe('Synergy Progress', () => {\n    test('calculateSynergyProgress should calculate correctly', () => {\n      const companions = ['goblin_technician'];\n      const progress = calculateSynergyProgress(mockSynergies[0], companions);\n      expect(progress.current).toBe(1);\n      expect(progress.required).toBe(2);\n      expect(progress.percentage).toBe(50);\n    });\n\n    test('calculateSynergyProgress should return 0% for no companions', () => {\n      const progress = calculateSynergyProgress(mockSynergies[0], []);\n      expect(progress.current).toBe(0);\n      expect(progress.percentage).toBe(0);\n    });\n\n    test('calculateSynergyProgress should return 100% for all companions', () => {\n      const companions = ['goblin_technician', 'goblin_craftsman'];\n      const progress = calculateSynergyProgress(mockSynergies[0], companions);\n      expect(progress.current).toBe(2);\n      expect(progress.percentage).toBe(100);\n    });\n  });\n\n  describe('Next Synergies', () => {\n    test('getNextSynergies should return incomplete synergies', () => {\n      const companions = ['goblin_technician'];\n      const next = getNextSynergies(companions, mockSynergies, 5);\n      expect(next.length).toBeGreaterThan(0);\n      expect(next.some((s) => s.id === 'goblin_team')).toBe(true);\n    });\n\n    test('getNextSynergies should not return completed synergies', () => {\n      const companions = ['goblin_technician', 'goblin_craftsman'];\n      const next = getNextSynergies(companions, mockSynergies, 5);\n      expect(next.some((s) => s.id === 'goblin_team')).toBe(false);\n    });\n\n    test('getNextSynergies should respect max recommendations', () => {\n      const companions = ['goblin_technician'];\n      const next = getNextSynergies(companions, mockSynergies, 1);\n      expect(next.length).toBeLessThanOrEqual(1);\n    });\n  });\n\n  describe('Synergy Stats', () => {\n    test('getSynergyStats should calculate correctly', () => {\n      const companions = ['goblin_technician', 'goblin_craftsman'];\n      const stats = getSynergyStats(companions, mockSynergies);\n      expect(stats.totalSynergies).toBe(2);\n      expect(stats.activeSynergies).toBe(1);\n      expect(stats.totalEffects).toBe(1);\n    });\n  });\n\n  describe('Validation', () => {\n    test('validateSynergyData should pass for valid data', () => {\n      const result = validateSynergyData(mockSynergies);\n      expect(result.valid).toBe(true);\n      expect(result.errors.length).toBe(0);\n    });\n\n    test('validateSynergyData should fail for missing ID', () => {\n      const invalid = [{ name: 'Test', requiredCompanionIds: ['a'], effects: [{ type: 'gold', value: 0.1 }] }];\n      const result = validateSynergyData(invalid as any);\n      expect(result.valid).toBe(false);\n      expect(result.errors.length).toBeGreaterThan(0);\n    });\n  });\n});\n
