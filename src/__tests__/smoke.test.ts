/**\n * Smoke 테스트: 핵심 게임 플로우 검증\n * Sprint 12: 6개 이상의 시나리오 자동화\n */\n\nimport { createDefaultInventory } from '../store';\nimport { calculateBattleReward } from '../utils/balance';\nimport { calculateActiveSynergies } from '../features/progression/companionSynergyEngine';\nimport { checkMissingKeys } from '../i18n/missingKeyDetector';\n\ndescribe('Smoke Tests: Core Game Flows', () => {\n  /**\n   * Scenario 1: 첫 실행 → 튜토리얼 완료\n   */\n  test('Scenario 1: First launch and tutorial completion', () => {\n    // 초기 상태\n    const initialState = createDefaultInventory();\n    expect(initialState.stage).toBe(1);\n    expect(initialState.gold).toBe(0);\n    expect(initialState.tutorialCompleted).toBe(false);\n\n    // 튜토리얼 완료\n    const afterTutorial = {\n      ...initialState,\n      tutorialCompleted: true,\n      gold: 100, // 튜토리얼 보상\n    };\n    expect(afterTutorial.tutorialCompleted).toBe(true);\n    expect(afterTutorial.gold).toBeGreaterThan(0);\n  });\n\n  /**\n   * Scenario 2: Home → Battle → 승리 → 보상 확인\n   */\n  test('Scenario 2: Battle flow and reward validation', () => {\n    const state = createDefaultInventory();\n    state.stage = 1;\n    state.atk = 10;\n\n    // 전투 시뮬레이션\n    const enemyHp = 50;\n    const reward = calculateBattleReward(state.stage, 1.0);\n\n    expect(reward.gold).toBeGreaterThan(0);\n    expect(reward.fragments).toBeGreaterThanOrEqual(0);\n    expect(reward.xp).toBeGreaterThan(0);\n  });\n\n  /**\n   * Scenario 3: 업그레이드 구매 → 전투 반영\n   */\n  test('Scenario 3: Upgrade purchase and battle impact', () => {\n    const state = createDefaultInventory();\n    state.gold = 500;\n    state.atk = 10;\n\n    const upgradeCost = 100;\n    const atkIncrease = 2;\n\n    // 업그레이드 구매\n    if (state.gold >= upgradeCost) {\n      state.gold -= upgradeCost;\n      state.atk += atkIncrease;\n    }\n\n    expect(state.gold).toBe(400);\n    expect(state.atk).toBe(12);\n\n    // 전투에서 높은 ATK 확인\n    const reward = calculateBattleReward(state.stage, 1.0);\n    expect(reward.gold).toBeGreaterThan(0);\n  });\n\n  /**\n   * Scenario 4: 오프라인 보상 수령\n   */\n  test('Scenario 4: Offline reward collection', () => {\n    const state = createDefaultInventory();\n    state.lastPlayTime = Date.now() - 3600000; // 1시간 전\n    state.gold = 100;\n\n    // 오프라인 보상 계산\n    const elapsedMs = Date.now() - state.lastPlayTime;\n    const elapsedHours = elapsedMs / (1000 * 60 * 60);\n    const offlineReward = Math.floor(50 * elapsedHours); // 시간당 50 골드\n\n    state.gold += offlineReward;\n    state.lastPlayTime = Date.now();\n\n    expect(state.gold).toBeGreaterThan(100);\n    expect(state.lastPlayTime).toBeLessThanOrEqual(Date.now());\n  });\n\n  /**\n   * Scenario 5: UGC 임포트 → 플레이 → 완료\n   */\n  test('Scenario 5: UGC import and play', () => {\n    // UGC 시나리오 데이터 (Base64)\n    const ugcCode = Buffer.from(\n      JSON.stringify({\n        title: 'Test Scenario',\n        stages: [\n          { monsterHp: 50, reward: { gold: 100, fragments: 5 } },\n          { monsterHp: 75, reward: { gold: 150, fragments: 8 } },\n        ],\n      })\n    ).toString('base64');\n\n    expect(ugcCode).toBeTruthy();\n\n    // UGC 플레이 시뮬레이션\n    const state = createDefaultInventory();\n    const initialGold = state.gold;\n\n    // 첫 번째 스테이지 클리어\n    state.gold += 100;\n    expect(state.gold).toBe(initialGold + 100);\n\n    // 두 번째 스테이지 클리어\n    state.gold += 150;\n    expect(state.gold).toBe(initialGold + 250);\n  });\n\n  /**\n   * Scenario 6: i18n 언어 전환 → 주요 화면 텍스트 확인\n   */\n  test('Scenario 6: i18n language switching', () => {\n    // i18n 누락 키 검사\n    const report = checkMissingKeys();\n\n    // 필수 키가 모두 있는지 확인\n    expect(report.missingInKo.length).toBe(0);\n    expect(report.missingInEn.length).toBe(0);\n\n    // 언어 전환 시뮬레이션\n    const languages = ['ko', 'en'];\n    languages.forEach(lang => {\n      expect(['ko', 'en']).toContain(lang);\n    });\n  });\n\n  /**\n   * Scenario 7: 동료 시너지 활성화 → 보상 증가\n   */\n  test('Scenario 7: Companion synergy activation', () => {\n    const mockSynergies = [\n      {\n        id: 'synergy_test',\n        requiredCompanionIds: ['companion1', 'companion2'],\n        effects: [{ type: 'goldGain', value: 0.1 }],\n      },\n    ];\n\n    const unlockedCompanions = ['companion1', 'companion2'];\n    const activeSynergies = calculateActiveSynergies(mockSynergies, unlockedCompanions);\n\n    expect(activeSynergies).toContain('synergy_test');\n  });\n\n  /**\n   * Scenario 8: 데이터 저장 및 로드\n   */\n  test('Scenario 8: Save and load game state', () => {\n    const state = createDefaultInventory();\n    state.stage = 10;\n    state.gold = 5000;\n    state.atk = 25;\n\n    // 저장 시뮬레이션\n    const savedData = JSON.stringify(state);\n    expect(savedData).toBeTruthy();\n\n    // 로드 시뮬레이션\n    const loadedState = JSON.parse(savedData);\n    expect(loadedState.stage).toBe(10);\n    expect(loadedState.gold).toBe(5000);\n    expect(loadedState.atk).toBe(25);\n  });\n\n  /**\n   * Scenario 9: 업적 해금 → 보상 수령\n   */\n  test('Scenario 9: Achievement unlock and reward', () => {\n    const state = createDefaultInventory();\n    state.totalBattles = 0;\n    state.gold = 100;\n\n    // 전투 10회 진행\n    for (let i = 0; i < 10; i++) {\n      state.totalBattles++;\n      state.gold += 50;\n    }\n\n    // 업적 \"10회 전투\" 해금\n    const achievementUnlocked = state.totalBattles >= 10;\n    expect(achievementUnlocked).toBe(true);\n\n    // 보상 수령\n    if (achievementUnlocked) {\n      state.gold += 200; // 업적 보상\n    }\n\n    expect(state.gold).toBe(100 + 500 + 200);\n  });\n\n  /**\n   * Scenario 10: 정비소 데코 구매 및 배치\n   */\n  test('Scenario 10: Decor purchase and placement', () => {\n    const state = createDefaultInventory();\n    state.cosmeticTokens = 500;\n    state.ownedDecor = ['wall_wood_basic'];\n\n    const decorPrice = 100;\n\n    // 데코 구매\n    if (state.cosmeticTokens >= decorPrice) {\n      state.cosmeticTokens -= decorPrice;\n      state.ownedDecor.push('wall_stone_basic');\n    }\n\n    expect(state.cosmeticTokens).toBe(400);\n    expect(state.ownedDecor).toContain('wall_stone_basic');\n  });\n});\n\n/**\n * 성능 테스트\n */\ndescribe('Smoke Tests: Performance', () => {\n  test('App startup should complete within 3 seconds', () => {\n    const startTime = performance.now();\n\n    // 앱 초기화 시뮬레이션\n    const state = createDefaultInventory();\n    const _ = checkMissingKeys();\n\n    const endTime = performance.now();\n    const duration = endTime - startTime;\n\n    expect(duration).toBeLessThan(3000);\n  });\n\n  test('Battle calculation should complete within 100ms', () => {\n    const startTime = performance.now();\n\n    for (let i = 0; i < 100; i++) {\n      calculateBattleReward(i + 1, 1.0);\n    }\n\n    const endTime = performance.now();\n    const duration = endTime - startTime;\n\n    expect(duration).toBeLessThan(100);\n  });\n});\n
