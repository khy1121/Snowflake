# 🔧 설화 정비소: 운영 가이드 (v1.2)

이 문서는 '설화 정비소'의 라이브 운영을 위한 가이드입니다. 인앱 메시지, A/B 실험, 랭킹, 주간 운영 체크리스트에 대한 내용을 포함합니다.

---

## 1. 인앱 메시지 운영

인앱 메시지(공지, 이벤트 배너, 우편함)는 원격 설정을 통해 제어됩니다. `RemoteConfigService`가 로드하는 JSON 파일에 아래 형식으로 메시지를 추가하거나 수정하여 운영합니다.

**원격 설정 JSON 예시**:

```json
{
  "inAppMessages": [
    {
      "id": "msg_weekend_boost_01",
      "type": "banner",
      "title": "주말 특별 부스트!",
      "body": "토/일요일에는 골드 획득량이 20% 증가해요!",
      "startAt": 1704499200000, // 2024-01-06 00:00:00 KST
      "endAt": 1704671999000,   // 2024-01-07 23:59:59 KST
      "priority": "medium",
      "ctaLabel": "확인",
      "isDismissible": true
    },
    {
      "id": "msg_update_1_2_notice",
      "type": "modal",
      "title": "v1.2 업데이트 안내",
      "body": "친구, 랭킹 시스템이 추가되었습니다. 지금 바로 새로운 기능을 즐겨보세요!",
      "startAt": 1704067200000,
      "endAt": 1704671999000,
      "priority": "high",
      "ctaLabel": "닫기",
      "isDismissible": false
    }
  ]
}
```

**주요 필드 설명**:
- `id`: 메시지의 고유 ID (중복 불가)
- `type`: `banner`(홈 상단), `modal`(팝업), `inbox`(우편함)
- `startAt`, `endAt`: 노출 시작/종료 시간 (Unix 타임스탬프, ms)
- `priority`: `high`, `medium`, `low` (높을수록 먼저 노출)
- `ctaRoute`: 클릭 시 이동할 앱 내 경로 (예: `Social`, `EventHub`)
- `isDismissible`: `false`로 설정 시 유저가 닫을 수 없는 중요 공지가 됩니다.

---

## 2. A/B 실험 운영

A/B 실험 역시 원격 설정을 통해 제어됩니다. 새로운 실험을 추가하거나 기존 실험의 그룹 비율(rollout)을 조정할 수 있습니다.

**실험 설정 JSON 예시**:

```json
{
  "experiments": [
    {
      "key": "offline_cap",
      "name": "오프라인 보상 상한 최적화",
      "variants": {
        "A": { "label": "8시간", "rollout": 50 },
        "B": { "label": "12시간", "rollout": 50 }
      },
      "isActive": true,
      "startAt": 1704067200000,
      "endAt": 1706745600000
    },
    {
      "key": "tutorial_flow_v2",
      "name": "튜토리얼 압축 실험",
      "variants": {
        "A": { "label": "기본 4스텝", "rollout": 0 },
        "B": { "label": "압축 3스텝", "rollout": 100 } // B그룹으로 100% 확산
      },
      "isActive": true,
      "startAt": 1704067200000,
      "endAt": 1706745600000
    }
  ]
}
```

**운영 절차**:
1.  **실험 설계**: `key`, `variants`, `rollout` 비율을 정의합니다.
2.  **원격 설정 배포**: JSON 파일을 업데이트합니다.
3.  **데이터 수집**: `EventTracker`를 통해 `experiment_exposure`, `experiment_result` 이벤트를 수집합니다.
4.  **결과 분석**: 수집된 데이터를 분석하여 어떤 그룹이 더 나은 성과를 보이는지 확인합니다.
5.  **확산(Rollout)**: 성과가 좋은 그룹의 `rollout` 비율을 100으로 조정하여 모든 유저에게 적용합니다.

---

## 3. 랭킹 운영

랭킹은 **주간 키(YYYY-WW)**를 기반으로 자동 리셋됩니다. 별도의 서버 작업 없이도 매주 월요일 0시(UTC 기준)에 새로운 랭킹이 시작됩니다.

**운영 포인트**:
- **보상 확인**: 매주 월요일, 이전 주차 랭킹 보상이 정상적으로 지급되었는지 확인합니다. (현재는 클라이언트 로직에 의해 자동 지급)
- **치트 모니터링**: `ValidationService`에 의해 기록되는 비정상 값 로그를 주기적으로 확인하고, 어뷰징 유저에 대한 조치를 검토합니다.
- **이벤트 랭킹**: 새로운 이벤트를 시작할 때, 해당 이벤트와 연결된 랭킹이 정상적으로 표시되는지 확인합니다.

---

## 4. 주간 운영 체크리스트

| 요일 | 담당 | 주요 업무 |
|---|---|---|
| **월요일** | 기획/운영 | - 지난 주 랭킹 보상 지급 확인<br>- 지난 주 A/B 실험 결과 분석 및 공유<br>- 이번 주 이벤트 시작 및 공지 | 
| **화요일** | 개발 | - 비정상/치트 로그 확인<br>- 크래시 리포트 분석 | 
| **수요일** | 기획/운영 | - 주간 이벤트 진행 상황 및 유저 피드백 확인<br>- 다음 주 업데이트/이벤트 기획 | 
| **목요일** | 개발 | - 성능 지표(FPS, 메모리) 모니터링<br>- 다음 주 빌드 준비 | 
| **금요일** | 기획/운영 | - 주말 이벤트 공지 (인앱 메시지)<br>- 커뮤니티 동향 파악 | 
| **토/일** | 모니터링 | - 서버 및 게임 안정성 모니터링 | 
