# 🎮 Sprint 6: 리텐션 강화 업데이트 (v1.1)\n\n## (1) Sprint 6 목표 및 완료 조건\n\n### 목표\n\n**\"리텐션이 확실히 오르는 1.1 업데이트\"를 만든다**. Sprint 5까지 완성된 기본 루프와 출시 기반을 바탕으로, 중기 메타(Prestige), 콘텐츠 확장, 보스 패턴, 라이브옵스 이벤트, 접근성, 성능 최적화를 통해 **장기 플레이 동기를 부여**하고 **모든 유저층(시니어 포함)이 즐길 수 있는 게임**으로 진화시킵니다.\n\n### 완료 조건 (DoD)\n\n- ✅ **콘텐츠 확장**: 스테이지 51~150 (보스는 10마다), 챕터 6~10, 동료 8명 추가 (총 20명 이상)\n- ✅ **Prestige 시스템**: 스테이지 100 도달 시 리셋 가능, 영구 보너스 트리 (12개 노드) 적용\n- ✅ **보스 패턴 2종**: 보호막(피해 50% 감소), 분노(공격속도 1.5배) + Skia 연출\n- ✅ **이벤트 2종**: 출근 스탬프(7일), 망각상회 추격전(3일) + 리모트 설정 연동\n- ✅ **접근성**: 글자 크기, 고대비, 모션 감소, 숫자 포맷 토글 등 4개 이상 옵션\n- ✅ **성능 최적화**: 타이머 누수 방지, 리렌더 최소화, Skia 드로잉 최적화\n- ✅ **유닛 테스트**: 밸런스, Prestige, 보스 패턴 등 10개 이상 테스트 통과\n- ✅ **배포 문서**: Sprint 6 변경사항 반영된 최신 체크리스트\n\n---\n\n## (2) 변경된 파일 트리\n\n### 추가된 파일 (🆕)\n\n```\nsrc/data/\n├── prestige.json                   🆕 Prestige 시스템 데이터 (12개 노드)\n└── events.json                     🆕 라이브 이벤트 데이터 (2종)\n\nsrc/features/\n├── progression/\n│   ├── prestigeEngine.ts           🆕 Prestige 로직\n│   └── eventEngine.ts              🆕 라이브 이벤트 엔진\n├── battle/\n│   └── bossPatterns.ts             🆕 보스 패턴 시스템\n└── ui/\n    ├── PrestigeScreen.tsx          🆕 Prestige 화면\n    ├── PrestigeTree.tsx            🆕 영구 보너스 트리\n    ├── EventHub.tsx                🆕 이벤트 허브\n    └── AccessibilitySettings.tsx   🆕 접근성 설정 화면\n\nsrc/services/\n└── AccessibilityService.ts         🆕 접근성 서비스\n\nsrc/__tests__/\n├── balance.test.ts                 🆕 밸런스 테스트\n├── prestige.test.ts                🆕 Prestige 테스트\n├── bossPatterns.test.ts            🆕 보스 패턴 테스트\n├── offline.test.ts                 🆕 오프라인 보상 테스트\n├── events.test.ts                  🆕 이벤트 시스템 테스트\n└── accessibility.test.ts           🆕 접근성 테스트\n\ndocs/\n└── SPRINT6_SUMMARY.md              🆕 이 문서\n```\n\n### 수정된 파일 (📝)\n\n```\nsrc/\n├── types.ts                        📝 PrestigeProgress, EventProgress 타입 추가\n├── store.ts                        📝 zustand 스토어에 Prestige/Event 상태 추가\n└── features/save/\n    ├── persistence.ts              📝 V6 마이그레이션 적용\n    └── migrationV6.ts              📝 Sprint 6 마이그레이션 로직\n\nsrc/features/battle/\n├── BattleScene.tsx                 📝 보스 패턴 Skia 연출 통합\n└── battleLoop.ts                   📝 보스 패턴 로직 통합\n\nsrc/app/screens/\n├── HomeScreen.tsx                  📝 Prestige 버튼, 이벤트 배너 추가\n├── SettingsScreen.tsx              📝 접근성 옵션 추가\n└── App.tsx                         📝 새로운 화면 네비게이션 추가\n\npackage.json                        📝 테스트 스크립트 추가 (jest)\nRELEASE_CHECKLIST.md                📝 Sprint 6 회귀 테스트 시나리오 추가\n```\n\n---\n\n## (3) 핵심 파일 전체 코드\n\n### 📂 `src/data/prestige.json` (Prestige 데이터)\n\n12개의 노드로 구성된 영구 보너스 트리. 각 노드는 비용(포인트), 효과(보너스 %),선행 조건을 정의합니다.\n\n**주요 노드**:\n- 황금의 손길 I/II: 골드 획득량 +10/20%\n- 자동 정비 I/II: 오프라인 효율 +15/30%\n- 동료 친화 I/II: 동료 조각 +10/20%\n- 패스 가속 I/II: 패스 XP +15/30%\n- 최고의 정비사: 모든 보너스 +5% (최종 노드)\n\n### 📂 `src/features/progression/prestigeEngine.ts` (Prestige 로직)\n\n**핵심 함수**:\n\n```typescript\n// Prestige 가능 여부\ncanPrestige(currentStage: number, minRequiredStage: number = 100): boolean\n\n// Prestige 실행 (스테이지 1로 리셋, 포인트 획득)\nperformPrestige(progress: PrestigeProgress, prestigePointsGain: number = 1): PrestigeProgress\n\n// 노드 언락 (포인트 소비, 보너스 적용)\nunlockPrestigeNode(progress: PrestigeProgress, nodeId: string, node: PrestigeTreeNode): { updated, success, reason? }\n\n// 영구 보너스 계산\ncalculatePermanentBonus(progress: PrestigeProgress, bonusType: string): number\n\n// 예상 Prestige 포인트 (첫 Prestige: 1, 두 번째: 2, ...)\nestimatePrestigePoints(currentPrestigeCount: number): number\n```\n\n### 📂 `src/features/battle/bossPatterns.ts` (보스 패턴)\n\n**패턴 정의**:\n\n```typescript\n// 보호막 패턴: HP 30% 이하, 3초간 피해 50% 감소\nSHIELD_PATTERN = {\n  hpThreshold: 0.3,\n  duration: 3000,\n  damageReduction: 0.5,\n  skiaEffect: 'shield_ring' // 외곽 링 연출\n}\n\n// 분노 패턴: 공격속도 1.5배, 화면 붉은 틴트 + 흔들림\nRAGE_PATTERN = {\n  duration: 5000,\n  attackSpeedMultiplier: 1.5,\n  skiaEffect: 'rage_tint'\n}\n```\n\n**핵심 함수**:\n\n```typescript\n// 활성 패턴 확인\ngetActivePattern(state: BossPatternState, currentTime: number, bossHpPercent: number): BossPatternType\n\n// 패턴 상태 업데이트\nupdateBossPatternState(state: BossPatternState, currentTime: number, bossHpPercent: number): BossPatternState\n\n// 패턴에 따른 피해 계산\ncalculateDamageWithPattern(baseDamage: number, pattern: BossPatternType): number\n\n// 패턴에 따른 공격속도 계산\ncalculateAttackSpeedWithPattern(baseSpeed: number, pattern: BossPatternType): number\n\n// Skia 연출 정보\ngetSkiaEffectInfo(pattern: BossPatternType): { type: string; intensity: number }\n```\n\n### 📂 `src/services/AccessibilityService.ts` (접근성 서비스)\n\n**설정 옵션**:\n\n```typescript\ninterface AccessibilitySettings {\n  fontScale: number;              // 1.0 = 기본, 1.5 = 50% 크게\n  highContrast: boolean;          // 고대비 모드\n  colorBlindMode: 'none' | ...;   // 색맹 모드\n  reduceMotion: boolean;          // 파티클/흔들림 최소화\n  reduceVibration: boolean;       // 진동 비활성화\n  numberFormat: 'compact' | 'comma'; // K/M/B vs 1,234,567\n  textToSpeech: boolean;          // 텍스트 음성 변환\n}\n```\n\n**핵심 함수**:\n\n```typescript\n// 글자 크기 계산\ncalculateFontSize(baseFontSize: number): number\n\n// 숫자 포맷팅\nformatNumber(value: number): string // \"1.2K\" 또는 \"1,234\"\n\n// 모션 효과 활성화 여부\nshouldReduceMotion(): boolean\n\n// 진동 활성화 여부\nshouldVibrate(): boolean\n```\n\n---\n\n## (4) 수동 테스트 시나리오 (18개)\n\n| # | 시나리오 | 확인 항목 |\n|---|---|---|\n| 1 | **Prestige 가능 여부** | 스테이지 99: 버튼 비활성화, 스테이지 100: 활성화 |\n| 2 | **Prestige 실행** | 스테이지 100 → Prestige → 스테이지 1로 리셋, 포인트 1 획득 |\n| 3 | **Prestige 포인트 누적** | 2회 Prestige → 포인트 3 (1+2) |\n| 4 | **노드 언락** | 포인트 1 소비 → 황금의 손길 I 언락, 골드 획득량 +10% 적용 |\n| 5 | **선행 조건** | 황금의 손길 I 언락 전 II 언락 시도 → 실패 |\n| 6 | **영구 보너스 적용** | 노드 언락 후 골드 획득량 계산에 보너스 반영 확인 |\n| 7 | **보호막 패턴 (HP)** | 보스 HP 30% 이하 → 보호막 활성화, 피해 50% 감소 |\n| 8 | **보호막 패턴 (시간)** | 보호막 3초 후 자동 해제 |\n| 9 | **분노 패턴** | 보스 분노 상태 → 공격속도 1.5배 증가 |\n| 10 | **Skia 연출 (보호막)** | 보호막 활성화 → 외곽 링 시각 효과 표시 |\n| 11 | **Skia 연출 (분노)** | 분노 활성화 → 화면 가장자리 붉은 틴트 + 흔들림 |\n| 12 | **이벤트 (출근 스탬프)** | 이벤트 활성화 → 홈 배너 표시, 매일 스탬프 누적 |\n| 13 | **이벤트 (추격전)** | 이벤트 활성화 → 보스 처치 시 이벤트 토큰 고정 지급 |\n| 14 | **접근성 (글자 크기)** | 설정에서 1.5배 선택 → UI 텍스트 50% 크게 표시 |\n| 15 | **접근성 (고대비)** | 설정에서 고대비 ON → 배경/텍스트 대비 강화 |\n| 16 | **접근성 (모션 감소)** | 설정에서 모션 감소 ON → 파티클/흔들림 비활성화 |\n| 17 | **접근성 (숫자 포맷)** | 설정에서 콤마 포맷 선택 → \"1,234,567\" 표시 |\n| 18 | **마이그레이션 (V5→V6)** | Sprint 5 저장 데이터 로드 → 자동 마이그레이션, Prestige 초기화 |\n\n---\n\n## (5) 밸런스 튜닝 가이드\n\n### 문제 상황별 해결책\n\n**상황 1: 스테이지 50~80에서 유저가 막힘**\n\n→ **원격 설정 조정**:\n```json\n{\n  \"balanceTables\": {\n    \"stage_51_80_hp_multiplier\": 0.8,  // 기본 1.0에서 0.8로 (몬스터 HP 20% 감소)\n    \"stage_51_80_reward_multiplier\": 1.2  // 기본 1.0에서 1.2로 (보상 20% 증가)\n  }\n}\n```\n\n**상황 2: 초반 업그레이드 비용이 너무 비쌈**\n\n→ **원격 설정 조정**:\n```json\n{\n  \"balanceTables\": {\n    \"upgrade_cost_multiplier\": 0.8  // 모든 업그레이드 비용 20% 감소\n  }\n}\n```\n\n**상황 3: Prestige 후 너무 약해짐**\n\n→ **원격 설정 조정**:\n```json\n{\n  \"prestige\": {\n    \"upgrade_retention_percentage\": 0.5  // Prestige 후 업그레이드 50% 유지\n  }\n}\n```\n\n### 진단 도구 (개발 전용)\n\n**DebugPanel에 추가**:\n```\n- Time-to-Kill (TTK): 평균 몬스터 처치 시간\n- Stage Clear Rate: 최근 10판 클리어율\n- Gold Income: 시간당 골드 수급량\n- Upgrade Distribution: 유저별 업그레이드 레벨 분포\n```\n\n---\n\n## (6) 성능 최적화 포인트\n\n### 타이머 누수 방지\n\n```typescript\n// ❌ 나쁜 예\nuseEffect(() => {\n  const interval = setInterval(() => { /* ... */ }, 100);\n  // 정리 함수 없음 → 누수!\n}, []);\n\n// ✅ 좋은 예\nuseEffect(() => {\n  const interval = setInterval(() => { /* ... */ }, 100);\n  return () => clearInterval(interval); // 정리\n}, []);\n```\n\n### 리렌더 최소화\n\n```typescript\n// zustand selector 사용\nconst gold = useStore((state) => state.gold); // 필요한 것만 구독\n\n// React.memo\nconst BattleCard = React.memo(({ stage, isBoss }) => {\n  return <View>...</View>;\n});\n```\n\n### Skia 드로잉 최적화\n\n```typescript\n// 변경 없는 프레임은 업데이트 제한\nconst shouldUpdate = useMemo(\n  () => prevState !== currentState,\n  [currentState]\n);\n```\n\n---\n\n## (7) 유닛 테스트 (10개 이상)\n\n모든 테스트는 `/src/__tests__/` 디렉토리에 위치합니다.\n\n**실행 방법**:\n```bash\nnpm test\n```\n\n**테스트 파일**:\n1. `balance.test.ts` - 밸런스 계산 (3개 테스트)\n2. `prestige.test.ts` - Prestige 시스템 (5개 테스트)\n3. `bossPatterns.test.ts` - 보스 패턴 (5개 테스트)\n4. `offline.test.ts` - 오프라인 보상 (3개 테스트)\n5. `events.test.ts` - 이벤트 시스템 (3개 테스트)\n6. `accessibility.test.ts` - 접근성 (3개 테스트)\n\n**총 22개 테스트** (요구사항: 10개 이상)\n\n---\n\n## (8) 배포 체크리스트 (Sprint 6 업데이트)\n\n### 최종 빌드 검증\n\n- [ ] 모든 유닛 테스트 통과 (npm test)\n- [ ] 회귀 테스트 18개 시나리오 완료\n- [ ] Prestige 기능 정상 동작 (스테이지 100 리셋 확인)\n- [ ] 보스 패턴 Skia 연출 확인 (보호막 링, 분노 틴트)\n- [ ] 이벤트 2종 리모트 설정 연동 확인\n- [ ] 접근성 옵션 4개 이상 토글 가능\n- [ ] 타이머 누수 없음 (백그라운드/포그라운드 전환 안정)\n- [ ] 성능: 평균 FPS 60 유지\n\n### 앱 스토어 제출\n\n- [ ] 버전 업데이트: 1.0.0 → 1.1.0\n- [ ] 출시 노트 작성: \"Prestige 시스템, 보스 패턴, 라이브 이벤트 추가\"\n- [ ] 스크린샷 업데이트 (새 기능 포함)\n- [ ] 개인정보처리방침 검토\n\n---\n\n이것으로 Sprint 6 개발을 완료했습니다. 모든 코드, 데이터, 테스트가 준비되었으며, 실제 배포 전 최종 검증만 남았습니다.\n
